if (!aboutSpoilerSVG) var aboutSpoilerSVG;
if (!aboutLinkSVG) var aboutLinkSVG;
if (!advantagesSliders) var advantagesSliders = [];
if (!appLinkSVG) var appLinkSVG;
if (!cases2Sliders) var cases2Sliders = [];
if (!cases3Sliders) var cases3Sliders = [];
if (!cases4Sliders) var cases4Sliders = [];
if (!cases5Sliders) var cases5Sliders = [];
if (!cases6Sliders) var cases6Sliders = [];
if (!ctaSubmitSVG) var ctaSubmitSVG;
if (!e404linkSVG) var e404linkSVG;
if (!footerLinkedinSVG) var footerLinkedinSVG;
if (!footerFbSVG) var footerFbSVG;
if (!footerInstagramSVG) var footerInstagramSVG;
if (!footerTwitterSVG) var footerTwitterSVG;
if (!headLinkSVG) var headLinkSVG;
if (!instagramSVG) var instagramSVG;
if (!modalCloseSVG) var modalCloseSVG;
if (!processSpoilerSVG) var processSpoilerSVG;
if (!processLinkSVG) var processLinkSVG;
if (!priceSubmitSVG) var priceSubmitSVG;
if (!paginationPrevSVG) var paginationPrevSVG;
if (!paginationNextSVG) var paginationNextSVG;
if (!popupCloseSVG) var popupCloseSVG;
if (!popupSuccessSVG) var popupSuccessSVG;
if (!ratesLinkSVG) var ratesLinkSVG;
if (!socialTwitterSVG) var socialTwitterSVG;
if (!socialFbSVG) var socialFbSVG;
if (!socialVkSVG) var socialVkSVG;
if (!socialInstagramSVG) var socialInstagramSVG;
if (!subMenuSVG) var subMenuSVG;
if (!docsCheckers) var docsCheckers;
if (!docsItems) var docsItems;
if (!docsList) var docsList;
if (!docsSlider) var docsSlider;
if (!gallerySliders) var gallerySliders = [];
if (!gallery2Sliders) var gallery2Sliders = [];
if (!gallery4Sliders) var gallery4Sliders = [];
if (!gallery5Sliders) var gallery5Sliders = [];
if (!headerHideInterval) var headerHideInterval;
if (!infoFactSlider) var infoFactSlider;
if (!instagramSlider) var instagramSlider;
if (!mainMenuCloseSVG) var mainMenuCloseSVG;
if (!mainMenuOpenSVG) var mainMenuOpenSVG;
if (!newsSlider) var newsSlider;
if (!partnersSliders) var partnersSliders = [];
if (!partners4Sliders) var partners4Sliders = [];
if (!promotionsSlider) var promotionsSlider;
if (!ratesListSliders) var ratesListSliders = [];
if (!rates6Sliders) var rates6Sliders = [];
if (!reviewsSliders) var reviewsSliders = [];
if (!reviews2Sliders) var reviews2Sliders = [];
if (!reviews3Sliders) var reviews3Sliders = [];
if (!servicesSlider) var servicesSlider;
if (!serviceBtns) var serviceBtns;
if (!serviceFilterNames) var serviceFilterNames;
if (!serviceFilterBtns) var serviceFilterBtns;
if (!serviceFilterSelect) var serviceFilterSelect;
if (!serviceItems) var serviceItems;
if (!service2Sliders) var service2Sliders = [];
if (!service4Intervals) var service4Intervals = [];
if (!customDropdowns) var customDropdowns;
if (!teamSliders) var teamSliders = [];
if (!timetablesSliders) var timetablesSliders = [];

if (!PRODUCTS_ON_PAGE) var PRODUCTS_ON_PAGE;
if (!CASES_ON_PAGE) var CASES_ON_PAGE;
if (!justClickedProductPagination) var justClickedProductPagination;
if (!productPagesCount) var productPagesCount;
if (!allProductsList) var allProductsList;
if (!productPaginationsWrappers) var productPaginationsWrappers;
if (!casesPagesCount) var casesPagesCount;
if (!allCasesList) var allCasesList;
if (!casesPaginationsWrappers) var casesPaginationsWrappers;
if (!allPopupRaisers) var allPopupRaisers;

if (!isPopupSuccessSVG) var isPopupSuccessSVG;
if (!isPopupCloseSVG) var isPopupCloseSVG;

if (!sliderArrow) var sliderArrow;
if (!ratesList) var ratesList;

if (!blocksWithBtnVariable) var blocksWithBtnVariable;

appInit = () => {};
docsInit = () => {};
infofactInit = () => {};
instagramInit = () => {};
newsInit = () => {};
paginationInit = () => {};
priceInit = () => {};
productsInit = () => {};
promotionInit = () => {};
servicesInit = () => {};
socialInit = () => {};
timetableInit = () => {};

aboutSpoilerSVG = "!!!";
aboutLinkSVG = "!!!";
appLinkSVG = "!!!";
backToTopSVG = "!!!";
ctaSubmitSVG = "!!!";
e404linkSVG = "!!!";
footerLinkedinSVG =
	'<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 9.357v5.908h-3.45v-5.52c0-1.38-.475-2.329-1.726-2.329-.949 0-1.51.647-1.768 1.25-.086.216-.13.518-.13.82v5.78h-3.45s.044-9.36 0-10.308h3.45v1.466s0 .043-.042.043h.043v-.043c.474-.69 1.25-1.725 3.105-1.725 2.242 0 3.967 1.51 3.967 4.658zM1.94 0C.777 0 0 .776 0 1.768s.733 1.768 1.898 1.768h.043c1.207 0 1.94-.776 1.94-1.768C3.838.776 3.105 0 1.941 0zM.173 15.268h3.407V4.961H.172v10.307z" fill="#fff"/></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h15.941v16H0z"/></clipPath></defs></svg>';
footerFbSVG =
	'<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.137 8H8.902v8H5.569V8H4V5.176h1.569V3.333C5.569 2.04 6.196 0 8.902 0h2.47v2.745H9.609c-.275 0-.706.157-.706.784v1.647h2.51L11.137 8z" fill="#fff"/></svg>';
footerTwitterSVG =
	'<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 2.544a6.356 6.356 0 01-1.882.527c.677-.415 1.204-1.055 1.43-1.807-.64.376-1.355.64-2.07.79A3.327 3.327 0 0011.068 1a3.278 3.278 0 00-3.275 3.275c0 .264.038.527.075.753-2.748-.15-5.157-1.43-6.776-3.426A3.128 3.128 0 00.64 3.26c0 1.13.565 2.146 1.468 2.748-.527 0-1.054-.15-1.506-.414v.038c0 1.58 1.13 2.936 2.636 3.237a3.21 3.21 0 01-.866.113c-.226 0-.414-.038-.603-.075.415 1.317 1.62 2.259 3.087 2.296a6.635 6.635 0 01-4.065 1.393c-.264 0-.527 0-.791-.037a9.215 9.215 0 005.045 1.468c6.06 0 9.336-5.007 9.336-9.337v-.414A7.042 7.042 0 0016 2.544z" fill="#fff"/></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h15.941v16H0z"/></clipPath></defs></svg>';
footerInstagramSVG =
	'<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)" fill="#fff"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.933 0c1.06.038 2.159.038 3.22.076.946.038 1.817.19 2.65.681 1.06.644 1.705 1.591 1.932 2.803.114.72.152 1.477.19 2.197.037 1.59 0 3.181 0 4.772 0 .833-.039 1.667-.304 2.462-.53 1.553-1.628 2.5-3.219 2.803-.72.151-1.477.151-2.197.19-1.59.037-3.143 0-4.734 0-.833 0-1.667-.039-2.462-.304-1.553-.53-2.5-1.628-2.803-3.22-.151-.719-.151-1.476-.19-2.196-.037-1.59 0-3.181 0-4.772 0-.833.039-1.667.304-2.462C.85 1.477 1.948.53 3.54.227 4.258.076 5.015.076 5.735.037 6.456 0 7.176 0 7.933 0zm6.55 7.84s-.037 0 0 0c-.037-.643-.037-1.25-.037-1.893 0-.606-.038-1.212-.114-1.818-.151-1.364-.947-2.273-2.272-2.538-.682-.151-1.44-.151-2.121-.151a72.277 72.277 0 00-4.053 0c-.682 0-1.363.037-2.007.151-1.137.19-1.932.833-2.273 1.97-.113.378-.151.757-.19 1.136-.037 1.439-.037 2.878-.037 4.317 0 .91.038 1.856.114 2.765.113 1.364.946 2.31 2.31 2.538.682.114 1.401.152 2.12.152 1.327.037 2.652 0 4.016 0 .606 0 1.212-.038 1.818-.114a2.648 2.648 0 001.553-.606c.757-.606 1.022-1.402 1.06-2.31.076-1.137.076-2.349.114-3.599z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12.025 7.992a4.073 4.073 0 01-4.09 4.09c-2.273 0-4.091-1.818-4.091-4.128 0-2.235 1.856-4.053 4.128-4.053 2.235 0 4.053 1.818 4.053 4.09zm-4.092 2.65c1.44 0 2.652-1.213 2.652-2.652 0-1.44-1.212-2.651-2.652-2.651a2.659 2.659 0 00-2.65 2.651c-.039 1.44 1.173 2.651 2.65 2.651z"/><path d="M12.854 3.639c0 .52-.409.964-.928.964-.52 0-.965-.445-.928-.964 0-.52.408-.928.928-.928s.928.408.928.928z"/></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h15.941v16H0z"/></clipPath></defs></svg>';
headLinkSVG = "!!!";
instagramSVG = "!!!";
mainMenuCloseSVG = '<svg class="header__menuCheckerCloseIcon" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6l12 12" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
mainMenuOpenSVG = '<svg class="header__menuCheckerOpenIcon" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8h18M3 16h18" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
modalCloseSVG = "!!!";
processSpoilerSVG = "!!!";
processLinkSVG = "!!!";
priceSubmitSVG = "!!!";
paginationPrevSVG = "!!!";
paginationNextSVG = "!!!";
popupCloseSVG =
	'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
popupSuccessSVG =
	'<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="40" cy="40" r="39" stroke="currentColor" stroke-width="2"/><path d="M50.6663 32L35.9997 46.6667L29.333 40" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
ratesLinkSVG = "!!!";
socialTwitterSVG = "!!!";
socialFbSVG = "!!!";
socialVkSVG = "!!!";
socialInstagramSVG = "!!!";
subMenuSVG = "!!!";
isPopupCloseSVG =
	'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#a)" fill="#000"><path d="m4.759 5.664.905-.905L19.24 18.336l-.905.905z"/><path d="m18.336 4.76.905.904L5.665 19.241l-.905-.905z"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h24v24H0z"/></clipPath></defs></svg>';
isPopupSuccessSVG =
	'<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="40" cy="40" r="39" stroke="currentColor" stroke-width="2"/><path d="M50.6663 32L35.9997 46.6667L29.333 40" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
sliderArrow = "M100 43.7H12.1l19.8-19.8-4.5-4.5L0 46.9l27.4 27.4 4.5-4.5L12.1 50H100z";

PRODUCTS_ON_PAGE = 2;
CASES_ON_PAGE = 2;
justClickedProductPagination = 0;

function getNextSibling(elem, selector) {
	var sibling = elem.nextElementSibling;

	if (!selector) return sibling;

	while (sibling) {
		if (sibling.matches(selector)) return sibling;
		sibling = sibling.nextElementSibling;
	}
}

function getPreviousSibling(elem, selector) {
	var sibling = elem.previousElementSibling;

	if (!selector) return sibling;

	while (sibling) {
		if (sibling.matches(selector)) return sibling;
		sibling = sibling.previousElementSibling;
	}
}

function injectSVG(target, svgString, before) {
	let temp = document.createElement("div");
	temp.innerHTML = svgString;
	if (before) {
		target.prepend(temp.firstChild);
	} else {
		target.append(temp.firstChild);
	}
}

function sendData(form) {
	var action = form.getAttribute("action");
	var FD = new FormData(form);

	return fetch(action, {
		method: "POST",
		body: FD,
	});
}

function isOverflownX({ clientWidth, scrollWidth }) {
	return scrollWidth > clientWidth;
}

if (!lastScrollTop) var lastScrollTop;
function headerScrollAnimate() {
	let header = document.querySelector(".headerAnimate");
	var st = window.pageYOffset || document.documentElement.scrollTop;
	if (st > lastScrollTop) {
		header.classList.add("headerHidden");
	} else {
		header.classList.remove("headerHidden");
	}
	lastScrollTop = st <= 0 ? 0 : st;
}

function windowClassOnScrollFunction() {
	var st = window.pageYOffset || document.documentElement.scrollTop;
	if (st < 20) {
		document.body.classList.add("pageStart");
	} else {
		document.body.classList.remove("pageStart");
	}
}

window.addEventListener("scroll", windowClassOnScrollFunction);
windowClassOnScrollFunction();

// iOS height fix.
function appHeight() {
	const doc = document.documentElement;
	doc.style.setProperty("--app-height", `${window.innerHeight}px`);
}
window.addEventListener("resize", appHeight);
appHeight();

if (document.querySelector(".constructorWrapper")) {
	document.body.classList.add("constructorActive");
}

blocksWithBtnVariable = document.querySelectorAll(".team, .reviews, .partners, .gallery, .gallery4, .gallery5, .rates, .cases2, .cases3, .cases4, .cases5, .rates6, .reviews2");
if (blocksWithBtnVariable.length) {
	window.addEventListener("resize", reloadBtnVariable);
}
function reloadBtnVariable() {
	blocksWithBtnVariable.forEach((item) => {
		let itemHeading = item.querySelector(".heading");

		if (item && itemHeading) {
			item.style.setProperty("--btn-top", itemHeading.offsetHeight + 20 + "px");
		}
	});
}

// Cookie.
function getCookie(name) {
	let matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, "\\$1") + "=([^;]*)"));
	return matches ? decodeURIComponent(matches[1]) : undefined;
}

function setCookie(name, value, options = {}) {
	options = {
		path: "/",
		...options,
	};

	if (options.expires instanceof Date) {
		options.expires = options.expires.toUTCString();
	}

	let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);

	for (let optionKey in options) {
		updatedCookie += "; " + optionKey;
		let optionValue = options[optionKey];
		if (optionValue !== true) {
			updatedCookie += "=" + optionValue;
		}
	}

	document.cookie = updatedCookie;
}

function closeCookie(evt) {
	setCookie("cookieAccepted", true, { secure: true, "max-age": 2592000 });
	evt.currentTarget.closest(".cookie").remove();
}

// Отображаем предупреждение о cookie.
if (!document.querySelector(".cookieHidden") && !document.querySelector(".constructorWrapper") && !getCookie("cookieAccepted")) {
	let cookieElement = document.createElement("div");
	cookieElement.classList.add("cookie");

	let cookieText = window["customCookieText"] ? window["customCookieText"] : "<p>We use <b>cookies</b>. This is necessary for the normal operation of the site.</p>";
	let cookieBtnText = window["customCookieBtnText"] ? window["customCookieBtnText"] : "Okay";

	cookieElement.innerHTML = `<div class="container cookie__container">${cookieText}<button onclick="closeCookie(event)" type="button">${cookieBtnText}</button></div>`;
	document.body.append(cookieElement);
}

// Анимация при скролле.
if (!containers) var containers;
if (!appearOptions) var appearOptions;
if (!appearObserver) var appearObserver;

containers = document.querySelectorAll(".section .container");
appearOptions = {
	root: null,
	rootMargin: "-100px 0px -100px 0px",
	// threshold: 0.1,
};
appearObserver = new IntersectionObserver((entries, observer) => {
	entries.forEach((entry) => {
		if (entry.isIntersecting) {
			entry.target.classList.add("visible");
		}
	});
}, appearOptions);

if (containers.length) {
	containers.forEach((item) => {
		appearObserver.observe(item);
	});
}

// Попапы.
allPopupRaisers = document.querySelectorAll('[litepage-button-type="form"]');

if (allPopupRaisers.length) {
	allPopupRaisers.forEach((item) => {
		item.addEventListener("click", showPopup);
	});
}

function showPopup(evt) {
	evt.preventDefault();
	let anchor = evt.currentTarget.getAttribute("href");

	let target = document.querySelector(`${anchor}`);
	if (target) {
		let isPopupOverlay = document.createElement("div");
		isPopupOverlay.classList.add("isPopupOverlay");
		isPopupOverlay.addEventListener("click", (evt) => {
			document.body.classList.remove("scrollOff");
			document.querySelector(".isPopup__close").remove();
			document.querySelector(".isPopup--visible").classList.remove("isPopup--visible");
			evt.currentTarget.remove();
		});
		target.parentNode.insertBefore(isPopupOverlay, target);

		target.classList.add("isPopup--visible");
		document.body.classList.add("scrollOff");

		let closeIsPopup = document.createElement("button");
		closeIsPopup.classList.add("isPopup__close");
		closeIsPopup.setAttribute("type", "button");
		closeIsPopup.setAttribute("aria-label", "Закрыть попап");
		injectSVG(closeIsPopup, isPopupCloseSVG);

		closeIsPopup.addEventListener("click", (evt) => {
			document.body.classList.remove("scrollOff");
			document.querySelector(".isPopupOverlay").remove();
			document.querySelector(".isPopup--visible").classList.remove("isPopup--visible");
			evt.currentTarget.remove();
		});

		document.body.append(closeIsPopup);
	}
}

function reloadAllSliders() {
	if (advantagesSliders.length) {
		advantagesSliders.forEach((item) => {
			item.resize();
		});
	}
	if (cases2Sliders.length) {
		cases2Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (cases3Sliders.length) {
		cases3Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (cases4Sliders.length) {
		cases4Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (cases5Sliders.length) {
		cases5Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (cases6Sliders.length) {
		cases6Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (docsSlider) {
		docsSlider.resize();
	}
	if (gallerySliders.length) {
		gallerySliders.forEach((item) => {
			item.resize();
		});
	}
	if (gallery2Sliders.length) {
		gallery2Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (gallery4Sliders.length) {
		gallery4Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (gallery5Sliders.length) {
		gallery5Sliders.forEach((item) => {
			item.resize();
		});
	}
	if (infoFactSlider) {
		infoFactSlider.resize();
	}
	if (instagramSlider) {
		instagramSlider.resize();
	}
	if (newsSlider) {
		newsSlider.resize();
	}
	if (partnersSliders.length) {
		partnersSliders.forEach((item) => {
			item.resize();
		});
	}
	if (promotionsSlider) {
		promotionsSlider.resize();
	}
	if (ratesListSliders.length) {
		ratesListSliders.forEach((item) => {
			item.resize();
		});
	}
	if (reviewsSliders.length) {
		reviewsSliders.forEach((item) => {
			item.resize();
		});
	}
	if (servicesSlider) {
		servicesSlider.resize();
	}
	if (teamSliders.length) {
		teamSliders.forEach((item) => {
			item.resize();
		});
	}
	if (timetablesSliders.length) {
		timetablesSliders.forEach((item) => {
			item.resize();
		});
	}
}

window.addEventListener("load", reloadAllSliders);
window.addEventListener("resize", reloadAllSliders);

// Функция для измерения длины заголовка в head.
if (!h1SizesLength) var h1SizesLength;
h1SizesLength = 9;

function h1Length(el) {
	let targets = document.querySelectorAll(el);

	if (targets.length) {
		targets.forEach((item) => {
			let target = item.querySelector("span") ? item.querySelector("span") : item;
			let length = target.innerText.length;

			item.classList.remove("heading--size-1");
			item.classList.remove("heading--size-2");
			item.classList.remove("heading--size-3");
			item.classList.remove("heading--size-4");
			item.classList.remove("heading--size-5");
			item.classList.remove("heading--size-6");
			item.classList.remove("heading--size-7");
			item.classList.remove("heading--size-8");
			item.classList.remove("heading--size-9");
			item.removeAttribute("data-size");

			if (length <= 16) {
				item.classList.add("heading--size-1");
				item.dataset.size = 1;
			} else if (length <= 31) {
				item.classList.add("heading--size-3");
				item.dataset.size = 3;
			} else if (length <= 48) {
				item.classList.add("heading--size-5");
				item.dataset.size = 5;
			} else if (length <= 64) {
				item.classList.add("heading--size-7");
				item.dataset.size = 7;
			} else {
				item.classList.add("heading--size-9");
				item.dataset.size = 9;
			}

			if (isOverflownX(item)) {
				// Есть длинное слово, нужна корректировка.
				h1LengthCorrect(item);
			}
		});
	}
}

function h1LengthCorrect(el) {
	let currentSize = +el.dataset.size;

	if (currentSize < h1SizesLength) {
		el.dataset.size = currentSize + 1;

		el.classList.remove(`heading--size-${currentSize}`);
		el.classList.add(`heading--size-${currentSize + 1}`);

		if (isOverflownX(el)) {
			h1LengthCorrect(el);
		}
	}
}

// Определение количества строк.
// function getStyle(el,styleProp)
// {
//     var x = el;
//     if (x.currentStyle)
//         var y = x.currentStyle[styleProp];
//     else if (window.getComputedStyle)
//         var y = document.defaultView.getComputedStyle(x,null).getPropertyValue(styleProp);
//     return y;
// }
// function calculateLineHeight (element) {

//   var lineHeight = parseInt(getStyle(element, 'line-height'), 10);
//   var clone;
//   var singleLineHeight;
//   var doubleLineHeight;

//   if (isNaN(lineHeight)) {
//     clone = element.cloneNode();
//     clone.innerHTML = '<br>';
//     element.appendChild(clone);
//     singleLineHeight = clone.offsetHeight;
//     clone.innerHTML = '<br><br>';
//     doubleLineHeight = clone.offsetHeight;
//     element.removeChild(clone);
//     lineHeight = doubleLineHeight - singleLineHeight;
//   }

//   return lineHeight;
// }

// function getNumlines(el){return Math.ceil(el.offsetHeight / calculateLineHeight (el))}
// console.log(getNumlines($0))

// Красим блоки.
function paintSections() {
	let thirdSections = document.querySelectorAll(".section--third");
	if (thirdSections.length) {
		thirdSections.forEach((item) => {
			item.classList.remove("section--third");
		});
	}

	let stopClassNames = ["cta", "cta4", "head", "head2", "head3", "head4", "head5", "head6", "head7", "head8", "head9", "head10", "e404", "header2", "header3", "header4", "header5", "header6", "header2", "header7", "header8", "header9", "section--third"];

	let allSections = document.querySelectorAll(".section");
	let allFilteredSections = [...allSections].filter((item) => {
		if (
			[...item.classList].some((itemClass) => {
				return stopClassNames.indexOf(itemClass) > -1;
			})
		) {
			return false;
		} else {
			return item;
		}
	});

	if (!document.querySelector(".page-content__selected")) {
		// Вне конструктора.
		allFilteredSections.forEach((section) => {
			// Если есть два элемента перед блоком...
			if (section.previousElementSibling && section.previousElementSibling.previousElementSibling) {
				// ...у предыдущих двух блоков нет стоп-класса...
				if (
					![...section.previousElementSibling.classList].some((itemClass) => {
						return stopClassNames.indexOf(itemClass) > -1;
					}) &&
					![...section.previousElementSibling.previousElementSibling.classList].some((itemClass) => {
						return stopClassNames.indexOf(itemClass) > -1;
					})
				) {
					// ...красим.
					section.classList.add("section--third");
				}
			}
		});
	} else {
		// В конструкторе.
		allFilteredSections.forEach((section) => {
			// Если есть два элемента перед блоком...
			if (section.closest(".page-content__selected").previousElementSibling && section.closest(".page-content__selected").previousElementSibling.previousElementSibling) {
				// ...у предыдущих двух блоков нет стоп-класса...
				if (
					![...section.closest(".page-content__selected").previousElementSibling.querySelector(".section").classList].some((itemClass) => {
						return stopClassNames.indexOf(itemClass) > -1;
					}) &&
					![...section.closest(".page-content__selected").previousElementSibling.previousElementSibling.querySelector(".section").classList].some((itemClass) => {
						return stopClassNames.indexOf(itemClass) > -1;
					})
				) {
					// ...красим.
					section.classList.add("section--third");
				}
			}
		});
	}
}

// После загрузки.
function blocksReady() {
	paintSections();
	paintHeaderMenu();
}

paintSections();

// Красим шапку без фона.
function padZero(str, len) {
	len = len || 2;
	var zeros = new Array(len).join("0");
	return (zeros + str).slice(-len);
}

function invertColor(hex, bw) {
	if (hex.indexOf("#") === 0) {
		hex = hex.slice(1);
	}
	if (hex.length === 3) {
		hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
	}
	if (hex.length !== 6) {
		console.log("Invalid HEX color: ", hex);
		throw new Error("Invalid HEX color.");
	}
	var r = parseInt(hex.slice(0, 2), 16),
		g = parseInt(hex.slice(2, 4), 16),
		b = parseInt(hex.slice(4, 6), 16);
	if (bw) {
		return r * 0.299 + g * 0.587 + b * 0.114 > 186 ? "dark" : "lite";
	}
	r = (255 - r).toString(16);
	g = (255 - g).toString(16);
	b = (255 - b).toString(16);
	return "#" + padZero(r) + padZero(g) + padZero(b);
}
function elementsAtLocation(x, y) {
	var stack = [],
		el;
	do {
		el = document.elementFromPoint(x, y);
		stack.push(el);
		el.classList.add("pointerEventsNone");
	} while (el.tagName !== "HTML");

	// clean up
	for (var i = 0; i < stack.length; i += 1) stack[i].classList.remove("pointerEventsNone");

	return stack;
}
function getAllElementsFromPoint(x, y) {
	var elements = [];
	var pointerEvents = [];
	var item = document.elementFromPoint(x, y);
	var lastItem;
	while (item && item !== lastItem && item !== document.body && item !== document && item !== document.documentElement) {
		elements.push(item);
		pointerEvents.push(item.style.pointerEvents);
		item.style.pointerEvents = "none";
		lastItem = item;
		item = document.elementFromPoint(x, y);
	}
	for (var i = 0; i < elements.length; i++) {
		elements[i].style.pointerEvents = pointerEvents[i];
	}
	return elements;
}

function rgbToHex(r, g, b) {
	return (
		"#" +
		[r, g, b]
			.map((x) => {
				const hex = (+x).toString(16);
				return hex.length === 1 ? "0" + hex : hex;
			})
			.join("")
	);
}

function paintHeaderMenu() {
	let header = document.querySelector('[id^="header"]:not(.headerWithBg)');
	if (header) {
		let currentSections = getAllElementsFromPoint(window.innerWidth / 2, header.getBoundingClientRect().height / 2);
		if (currentSections.length) {
			currentSections.forEach((item) => {
				if (item.classList.contains("section")) {
					let currentSectionBgColor = rgbToHex(...window.getComputedStyle(item, null).getPropertyValue("background-color").replace("rgb(", "").replace(")", "").split(", "));
					let newColorType = invertColor(currentSectionBgColor, true);
					let newColorForHeader = newColorType == "dark" ? "var(--headerTextDark, #000)" : "var(--headerTextLite, #fff)";
					header.style.setProperty("--headerText", newColorForHeader);
				}
			});
		}
	} else {
		let header = document.querySelector(".headerWithBg");
		if (header) {
			if (document.querySelector(".pageStart")) {
				let currentSections = getAllElementsFromPoint(window.innerWidth / 2, header.getBoundingClientRect().height / 2);
				if (currentSections.length) {
					currentSections.forEach((item) => {
						if (item.classList.contains("section")) {
							let currentSectionBgColor = rgbToHex(...window.getComputedStyle(item, null).getPropertyValue("background-color").replace("rgba(", "").replace("rgb(", "").replace(")", "").split(", "));
							let newColorType = invertColor(currentSectionBgColor, true);
							let newColorForHeader = newColorType == "dark" ? "var(--headerTextDark, #000)" : "var(--headerTextLite, #fff)";
							header.style.setProperty("--headerText", newColorForHeader);
						}
					});
				}
			} else {
				header.style.setProperty("--headerText", "");
			}
		}
	}
}
window.addEventListener("scroll", paintHeaderMenu);
if (document.querySelector(".constructorActive")) {
	document.body.addEventListener("scroll", paintHeaderMenu);
}
paintHeaderMenu();
